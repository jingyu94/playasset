# 11. 배포/인프라/DB 전략 (2026 최신)

## 1) 현재 표준 스택
- 클라이언트: Flutter Web (Nginx 서빙)
- 백엔드: Spring Boot 3.3 + Java 21 (MVC + WebFlux 혼합)
- 데이터: MySQL 8.0
- 캐시: Redis 7
- 이벤트 스트리밍: Kafka (KRaft 단일 노드 기준)
- 컨테이너 오케스트레이션: Docker Compose(로컬), Kubernetes(EKS 대상)

## 2) 왜 Redis를 붙였는가
- 대시보드/포지션/관심종목/알림/자산 인사이트 API는 읽기 비중이 높음
- 동일 사용자의 짧은 간격 재조회가 많아 DB 중복 부하가 큼
- 해결: Redis 캐시 TTL을 API 특성별로 분리
  - 대시보드/포지션: 짧은 TTL
  - 인사이트/시뮬레이션: 중간 TTL
- 거래 입력/배치 완료 시 캐시 무효화 처리

## 3) 왜 Kafka를 스택에 포함했는가
- 향후 포트폴리오 분석, 알림, AI 추천, 배치 후처리를 분리할 때 이벤트 허브가 필요함
- 1차 목표는 인프라 준비(토픽/컨슈머는 점진 도입)
- 로컬은 단일 노드 KRaft, 운영은 멀티 브로커로 확장

## 4) Nginx 유지 이유
- Flutter Web 정적 파일 서빙 + `/api` 프록시 단일화
- CORS 복잡도 감소
- 추후 TLS/보안 헤더/캐시정책 중앙 제어에 유리

## 5) DB 전략 (MySQL 유지, 단계적 확장)
- 현 단계 최적: MySQL 유지 + 인덱스/쿼리 튜닝 + 캐시 계층
- 확장 단계:
  - Read Replica
  - 대용량 테이블 파티셔닝(시간축/사용자축)
  - 이벤트 비동기화(Kafka)
- 전환 검토 시점:
  - 복잡 분석 쿼리, JSON 중심 모델, 멀티 리전 요구가 크게 증가할 때

## 6) 배포 형태
- 로컬: `docker compose up -d --build`
- 쿠버네티스: `kubectl apply -k infra/k8s/base`
- 퍼블릭 노출: AWS EKS + ALB Ingress + Route53

## 7) 현재 반영 상태
- Compose: MySQL/Redis/Kafka/Kafka-UI/Server/Web 구성 완료
- Backend: Redis 캐시 + 캐시 무효화 + Kafka 연결 설정값 반영
- K8s: base 매니페스트 추가 완료(미래 portfolio-service placeholder 포함)
- AWS 배포 문서: `14_AWS_EKS_퍼블릭엔드포인트_배포가이드_2026.md`
- 수동 개입 항목 문서: `15_수동개입_체크리스트_2026.md`
