# PlayAsset OTA(Shorebird) 운영 가이드 (2026)

## 1. 목적
- APK 재설치 없이 Flutter(Dart) 코드 패치를 배포합니다.
- 원격 설정(TM_STD_RUNTIME_CONFIG_MAIN)과 조합해 운영 반영 시간을 단축합니다.

## 2. 적용 범위
- 가능:
  - Flutter UI/비즈니스 로직(Dart 코드) 수정
  - 텍스트/레이아웃/스타일/일반 동작 수정
- 불가(스토어 재배포 필요):
  - Android 네이티브 코드(`android/`), 권한/매니페스트 변경
  - 플러그인 네이티브 바이너리 변경, 앱 서명/패키지 구조 변경

## 3. 사전 준비
- 로컬 설치:
  - `flutter --version`
  - `shorebird --version`
  - (Windows 권장) 관리자 PowerShell:
    - `git config --system core.longpaths true`
- 최초 1회:
  - `shorebird login`
  - `shorebird init` (앱 연결)
- GitHub Secrets:
  - `SHOREBIRD_TOKEN`
  - `SHOREBIRD_APP_ID`

## 4. 운영 명령 (로컬)
- 위치: 프로젝트 루트 `c:\workspace\PlayAsset`
- 점검:
  - `powershell -ExecutionPolicy Bypass -File scripts/shorebird-ota.ps1 -Mode doctor`
  - `powershell -ExecutionPolicy Bypass -File scripts/shorebird-ota.ps1 -Mode status`
- 릴리즈(기준 배포):
  - `powershell -ExecutionPolicy Bypass -File scripts/shorebird-ota.ps1 -Mode release -BuildName 0.01 -BuildNumber 1`
- 패치(OTA):
  - `powershell -ExecutionPolicy Bypass -File scripts/shorebird-ota.ps1 -Mode patch -BuildName 0.01 -BuildNumber 2`
- dry-run 검증:
  - `powershell -ExecutionPolicy Bypass -File scripts/shorebird-ota.ps1 -Mode patch -BuildName 0.01 -BuildNumber 2 -DryRun`

## 5. GitHub Actions 운영
- 워크플로우: `.github/workflows/shorebird-ota.yml`
- 트리거: `workflow_dispatch`
- 입력:
  - `mode`: `release` 또는 `patch`
  - `target`: `android`
  - `build_name`, `build_number`

## 6. 권장 릴리즈 전략
- 버전 규칙:
  - `build_name`: 제품 버전(예: `0.01`)
  - `build_number`: 배포 증가값(1,2,3...)
- 순서:
  1. 스토어/초기 배포 1회(기준 릴리즈)
  2. 경미 수정은 OTA patch
  3. 네이티브 변경 시 스토어 재배포 후 patch 재개

## 7. 장애 대응
- 패치 이상 시:
  - 즉시 새 patch로 롤포워드
  - 필요하면 스토어 버전으로 기준선 재설정
- 확인 항목:
  - `shorebird releases list --android`
  - `shorebird patches list --android`

## 8. PlayAsset 적용 원칙
- 운영 중 자주 바뀌는 항목:
  - 문구/룰/임계치: DB 기준정보(TM_*)에서 관리
  - UI/동작 로직: OTA patch로 반영
- 릴리즈 후 반드시:
  - `docs/rearchitecture/17_네이밍_온톨로지_LLM캐시_운영가이드_2026.md` 현행화
  - 수동 개입 항목은 `docs/rearchitecture/15_수동개입_체크리스트_2026.md` 갱신
