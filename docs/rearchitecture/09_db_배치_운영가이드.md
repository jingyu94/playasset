# DB/배치 운영 가이드

## DB 초기화 방식
- Flyway 기반 자동 마이그레이션
  - `V1__core_schema.sql`
  - `V2__seed_sample_data.sql`
- 대상 스키마
  - `playasset_core`

## 샘플 데이터
- 사용자: 1명(`user_id=1001`)
- 자산: 5개
- 워치리스트: 1개
- 포지션/거래/뉴스/알림/배치이력 기본 삽입

## 배치 작업
- 클래스: `MarketNewsBatchService`
- 작업 1: `MARKET_SNAPSHOT`
  - 활성 자산 기준 일봉 캔들 배치 upsert
  - 기본 주기: 5분
- 작업 2: `NEWS_SENTIMENT_REFRESH`
  - 샘플 뉴스/감성 배치 생성
  - 기본 주기: 7분
- 결과 저장: `ingestion_jobs`

## 외부 API 키 공란 정책
- 현재 기본값
  - `EXTERNAL_MARKET_API_KEY=""`
  - `EXTERNAL_NEWS_API_KEY=""`
- 공란이면 배치가 내부 시뮬레이터 모드(`SYNTHETIC`)로 동작

## 고처리량 설정
- Tomcat threads max/min-spare/accept-count 튜닝
- HikariCP 풀 크기/타임아웃 설정
- Virtual Threads 활성화
- 응답 압축 활성화
- Prometheus 메트릭 노출

## 깨끗한 재기동
- 기존 볼륨 데이터까지 초기화하려면
  - `docker compose down -v`
  - `docker compose up -d --build`
