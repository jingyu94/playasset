# 전환 계획 (현재 -> 재설계 목표)

## 1. 현재 기준점
- 단일 Spring Boot 앱
- 레거시 스키마(`TM_*`) + 임시 뉴스 테이블
- 최소 UI 프로토타입
- Docker Compose(app + mysql)

## 2. 단계별 로드맵
### Phase 0: 안정화 (1~2주)
- 기존 엔드포인트 동결
- API 버전 접두어(`/api/v1`) 추가
- 공통 에러 응답 포맷 정의
- Flyway/Liquibase 도입
- 완료 기준: 기존 기능 재현 가능한 로컬 실행

### Phase 1: 데이터 기반 재정비 (1~2주)
- v2 스키마 도입
- `TM_*` -> v2 마이그레이션 스크립트 정비
- 평문 인증정보 제거
- 완료 기준: 핵심 읽기/쓰기 v2에서 동작

### Phase 2: 모듈형 모놀리스 (2~4주)
- 모듈 분리
  - identity
  - portfolio
  - market
  - news
  - insight
- 배포 단위는 일단 1개 유지
- 완료 기준: 패키지 경계 위반 방지 규칙 적용

### Phase 3: 서비스 추출 (4주+)
- 추출 순서
  1. news-service
  2. market-service
  3. insight-service
  4. notification-service
- Outbox + Event Bus 도입
- 완료 기준: 교차 DB 의존 제거, 이벤트 재처리 안전

### Phase 4: 하드닝
- RBAC
- 감사/보안 로그
- SLO 운영 대시보드 + 장애 대응 런북
- 성능/비용 최적화

## 3. 주요 리스크와 대응
- 리스크: 마이그레이션 데이터 불일치
  - 대응: 듀얼라이트 구간 + 검증 배치
- 리스크: 이벤트 중복/순서 문제
  - 대응: Outbox + 컨슈머 멱등 키
- 리스크: 조기 과분리
  - 대응: 모듈형 모놀리스 선행

## 4. 재설계 완료 조건
- v2 도메인 스키마 운영 반영
- v1 API 계약 문서화 및 버전 고정
- Docker Compose에서 최소 3개 독립 서비스 실행
- E2E 흐름 검증
  - 회원가입 -> 관심종목 -> 거래등록 -> 인사이트 -> 알림

